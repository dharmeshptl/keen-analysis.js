!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t){e.exports=function(e,t,n){var o;if(!e)return 0;if(n=n||e,e instanceof Array){for(o=0;o<e.length;o++)if(!1===t.call(n,e[o],o,e))return 0}else for(o in e)if(e.hasOwnProperty(o)&&!1===t.call(n,e[o],o,e))return 0;return 1}},function(e,t){e.exports=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])e[n]=arguments[t][n];return e}},function(e,t,n){var o=n(0);n(1);e.exports=function(e){var t=[];return o(e,function(e,n){"string"!=typeof e&&(e=JSON.stringify(e)),t.push(n+"="+encodeURIComponent(e))}),t.join("&")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DELETE=t.PUT=t.POST=t.GET=void 0;var o=i(n(0)),r=i(n(2));function i(e){return e&&e.__esModule?e:{default:e}}t.GET=function(e,t){return"undefined"!=typeof fetch?s("GET",e,t):u()?a("GET",e,t):c()?f("GET",e,t):function(e,t){var n=e.url,o=t,i=(new Date).getTime(),s=document.createElement("script"),u=document.getElementsByTagName("head")[0],a="keenJSONPCallback",c=!1;a+=i;for(;a in window;)a+="a";window[a]=function(e){!0!==c&&f(null,e)},e.params&&(n+=(0,r.default)(e.params));function f(e,n){c=!0,o&&"function"==typeof o&&(o(e,n),t=o=void 0),window[a]=void 0;try{delete window[a]}catch(e){}u.removeChild(s)}s.onreadystatechange=function(){!1===c&&"loaded"===this.readyState&&f("An error occurred",null)},s.onerror=function(){!1===c&&f("An error occurred",null)},s.src=n+"&jsonp="+a,u.appendChild(s)}(e,t)},t.POST=function(e,t){if("undefined"!=typeof fetch)return console.log("FETCHING"),s("POST",e,t);if(u())return a("POST",e,t);if(c())return f("POST",e,t);t("XHR POST not supported",null)},t.PUT=function(e,t){if("undefined"!=typeof fetch)return s("PUT",e,t);if(u())return a("PUT",e,t);t("XHR PUT not supported",null)},t.DELETE=function(e,t){if("undefined"!=typeof fetch)return s("DELETE",e,t);if(u())return a("DELETE",e,t);t("XHR DELETE not supported",null)};function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=this,s={},u=t.url;return"GET"==e&&(u+="?",t.api_key&&(u+="api_key="+t.api_key+"&"),t.params&&(u+=(0,r.default)(t.params))),(0,o.default)(t.headers,function(e,t){"string"==typeof e&&(s[t]=e)}),fetch(u,{method:e,body:"GET"!==e&&t.params?JSON.stringify(t.params):void 0,mode:"cors",headers:s}).then(function(e){return e.ok?e.json():e.json().then(function(t){return Promise.reject({error_code:t.error_code,body:t.message,status:e.status,ok:!1,statusText:e.statusText})})}).then(function(e){return void 0!==n&&n.call(i,null,e),Promise.resolve(e)})}function u(){var e="undefined"==typeof window?this:window;if(e.XMLHttpRequest&&(!e.ActiveXObject||e.location&&e.location.protocol&&"file:"!==e.location.protocol))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1}function a(e,t,n){var i=u(),s=n,a=t.url;return i.onreadystatechange=function(){var e=void 0;if(4==i.readyState)if(i.status>=200&&i.status<300)if(204===i.status)s&&s(null,i);else try{e=JSON.parse(i.responseText),s&&e&&s(null,e)}catch(e){s&&s(i,null)}else try{e=JSON.parse(i.responseText),s&&e&&s(e,null)}catch(e){s&&s(i,null)}},"GET"!==e?(i.open(e,a,!0),(0,o.default)(t.headers,function(e,t){"string"==typeof e&&i.setRequestHeader(t,e)}),t.params?i.send(JSON.stringify(t.params)):i.send()):(a+="?",t.api_key&&(a+="api_key="+t.api_key+"&"),t.params&&(a+=(0,r.default)(t.params)),i.open(e,a,!0),(0,o.default)(t.headers,function(e,t){"string"==typeof e&&i.setRequestHeader(t,e)}),i.send()),i}function c(){var e="undefined"==typeof window?this:window;return!!e.XDomainRequest&&new e.XDomainRequest}function f(e,t,n){var o=c(),i=n;function s(e,t){i&&"function"==typeof i&&(i(e,t),n=i=void 0)}return o&&(o.timeout=t.timeout||3e5,o.ontimeout=function(){s(o,null)},o.onerror=function(){s(o,null)},o.onload=function(){s(null,JSON.parse(o.responseText))},o.open(e.toLowerCase(),t.url),setTimeout(function(){t.params?o.send((0,r.default)(t.params)):o.send()},0)),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=u,t.getAnalysisType=a;var r=s(n(0)),i=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return this.httpHandlers=t,function(t){return this.config={api_key:void 0,method:e,params:void 0,timeout:3e5,url:t,headers:{Authorization:"","Content-type":"application/json"}},this}.bind(this)}function a(e){var t=e.split("/queries/");return t[t.length-1]}u.prototype.auth=function(e){return"string"==typeof e&&(this.config.api_key="string"==typeof e?e:void 0,this.headers({Authorization:e})),this},u.prototype.headers=function(e){return"object"===(void 0===e?"undefined":o(e))&&(0,r.default)(e,function(e,t){this.config.headers[t]=e}.bind(this)),this},u.prototype.timeout=function(e){return this.config.timeout="number"==typeof e?e:3e5,this},u.prototype.send=function(e){this.config.params=e&&"object"===(void 0===e?"undefined":o(e))?e:{};var t=this.httpHandlers[this.config.method],n=(0,i.default)({},this.config);return void 0===n.params.analysis_type&&n.url.indexOf("/queries/")>-1&&n.url.indexOf("/saved/")<0&&(n.params.analysis_type=a(n.url)),new Promise(function(e,o,r){var s=t(n,function(t,r){var s=r;t?o(t):(void 0!==n.params.event_collection&&void 0===r.query&&(s=(0,i.default)({query:n.params},r)),e(s))});return console.log(r),r&&(console.log("ooo"),r(function(){s.abort&&s.abort()})),s})}},function(e,t,n){function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}e.exports=o,o.prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if((n=o[r])===t||n.fn===t){o.splice(r,1);break}return this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t);return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){e.exports=function(e){var t,n={},o=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(o," "))},s=e.split("?")[1];for(;t=r.exec(s);)n[i(t[1])]=i(t[2]);return n}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){(function(t){var o=t.Keen||void 0,r=n(0),i=n(1),s=n(6),u=n(2),a=n(5);function c(e){if(this instanceof c==!1)return new c(e);this.configure(e),c.debug&&this.on("error",c.log),this.emit("ready"),c.emit("client",this)}function f(e){return void 0!==e}o&&void 0===o.resources&&(c.legacyVersion=o),a(c),a(c.prototype),i(c,{debug:!1,enabled:!0,loaded:!1,version:"__VERSION__"}),c.helpers=c.helpers||{},c.resources=c.resources||{},i(c.resources,{base:"{protocol}://{host}",version:"{protocol}://{host}/3.0",projects:"{protocol}://{host}/3.0/projects",projectId:"{protocol}://{host}/3.0/projects/{projectId}",events:"{protocol}://{host}/3.0/projects/{projectId}/events",queries:"{protocol}://{host}/3.0/projects/{projectId}/queries",datasets:"{protocol}://{host}/3.0/projects/{projectId}/datasets"}),c.utils=c.utils||{},i(c.utils,{each:r,extend:i,parseParams:s,serialize:u}),c.extendLibrary=function(e,t){var n=o||t;return f(n)&&f(n.resources)&&(r(n,function(t,n){"object"==typeof t?(e[n]=e[n]||{},i(e[n],t)):e[n]=e[n]||t}),i(e.prototype,n.prototype)),e},c.log=function(e){c.debug&&"object"==typeof console&&console.log("[Keen]",e)},c.noConflict=function(){return void 0!==t.Keen&&(t.Keen=c.legacyVersion||o),c},c.ready=function(e){c.loaded?e():c.once("ready",e)},c.prototype.configure=function(e){var t=e||{};return this.config=this.config||{projectId:void 0,writeKey:void 0,host:"api.keen.io",protocol:"https",requestType:"jsonp",resources:i({},c.resources)},"undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1&&(t.protocol=document.location.protocol.replace(":","")),t.host&&t.host.replace(/.*?:\/\//g,""),i(this.config,t),this},c.prototype.masterKey=function(e){return arguments.length?(this.config.masterKey=e?String(e):null,this):this.config.masterKey},c.prototype.projectId=function(e){return arguments.length?(this.config.projectId=e?String(e):null,this):this.config.projectId},c.prototype.resources=function(e){if(!arguments.length)return this.config.resources;var t=this;return"object"==typeof e&&r(e,function(e,n){t.config.resources[n]=e||null}),t},c.prototype.url=function(e){var t,n=Array.prototype.slice.call(arguments,1),o=this.config.resources.base||"{protocol}://{host}";return t=e&&"string"==typeof e?this.config.resources[e]?this.config.resources[e]:o+e:o,r(this.config,function(e,n){"object"!=typeof e&&(t=t.replace("{"+n+"}",e))}),r(n,function(e,n){"string"==typeof e?t+="/"+e:"object"==typeof e&&(t+="?",r(e,function(e,n){t+=n+"="+e+"&"}),t=t.slice(0,-1))}),t},function(e){if(c.loaded||"undefined"==typeof document)return void e();null==document.readyState&&document.addEventListener&&(document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,!1),document.readyState="complete"},!1),document.readyState="loading");!function e(t){/in/.test(document.readyState)?setTimeout(function(){e(t)},9):t()}(e)}(function(){c.loaded=!0,c.emit("ready")}),e.exports=c}).call(this,"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{})}).call(this,n(7))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeenAnalysis=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=u(n(8)),i=u(n(0)),s=u(n(1));function u(e){return e&&e.__esModule?e:{default:e}}function a(e,t){this.analysis=e,this.params={},this.set(t),void 0===this.params.timezone&&(this.params.timezone=-60*(new Date).getTimezoneOffset())}r.default.prototype.readKey=function(e){return arguments.length?(this.config.readKey=e?String(e):null,this):this.config.readKey},r.default.prototype.query=function(e,t){if(e&&t&&"string"==typeof t)return t.indexOf("/result")<0&&(t+="/result"),this.get(this.url("queries",e,t)).auth(this.readKey()).send();if("dataset"===e&&"object"===(void 0===t?"undefined":o(t)))return this.get(this.url("datasets",t.name,"results")).auth(this.readKey()).send(t);if(e&&t&&"object"===(void 0===t?"undefined":o(t))){var n=(0,s.default)({analysis_type:e},t);return this.post(this.url("queries",e)).auth(this.readKey()).send(n)}return e&&!t?Promise.reject({error_code:"SDKError",message:".query() called with incorrect arguments"}):void 0},r.default.Query=a,r.default.prototype.run=function(e,t){var n=this,o=t,u=void 0,a=e instanceof Array?e:[e],c=[];return(0,i.default)(a,function(e,t){"string"==typeof e?c.push(n.query("saved",e+"/result")):e instanceof r.default.Query&&c.push(n.query(e.analysis,(0,s.default)({analysis_type:e.analysis},e.params)))}),u=c.length>1?Promise.all(c):c[0],o&&(u.then(function(e){o(null,e)}),u.catch(function(e){o(e,null)})),u},a.prototype.set=function(e){var t=this;return(0,i.default)(e,function(e,n){var r=n,s=e;n.match(new RegExp("[A-Z]"))&&(r=n.replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})),t.params[r]=s,s instanceof Array&&(0,i.default)(s,function(e,n){e instanceof Array==0&&"object"===(void 0===e?"undefined":o(e))&&(0,i.default)(e,function(e,o){if(o.match(new RegExp("[A-Z]"))){var i=o.replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()});delete t.params[r][n][o],t.params[r][n][i]=e}})})}),t},a.prototype.get=function(e){var t=e;if(t.match(new RegExp("[A-Z]"))&&(t=t.replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})),this.params)return this.params[t]||null},a.prototype.addFilter=function(e,t,n){return this.params.filters=this.params.filters||[],this.params.filters.push({property_name:e,operator:t,property_value:n}),this};var c=t.KeenAnalysis=r.default;t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keen=void 0;s(n(1));var o=s(n(9)),r=s(n(4)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(3));function s(e){return e&&e.__esModule?e:{default:e}}o.default.prototype.get=new r.default("GET",i),o.default.prototype.post=new r.default("POST",i),o.default.prototype.put=new r.default("PUT",i),o.default.prototype.del=new r.default("DELETE",i);var u=t.Keen=o.default.extendLibrary(o.default);t.default=u},function(e,t,n){e.exports=n(10)}])});
//# sourceMappingURL=keen-analysis.min.js.map