{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./node_modules/keen-core/lib/utils/extend.js","webpack:///./node_modules/promise-polyfill/src/finally.js","webpack:///./node_modules/promise-polyfill/src/index.js","webpack:///./node_modules/promise-polyfill/src/polyfill.js","webpack:///./node_modules/keen-core/lib/utils/each.js","webpack:///./node_modules/keen-core/lib/utils/serialize.js","webpack:///external \"url\"","webpack:///external \"https\"","webpack:///./lib/utils/http-server.js","webpack:///./lib/blank.js","webpack:///./lib/request.js","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///external \"csvtojson\"","webpack:///./lib/utils/node-load-data-from-file.js","webpack:///external \"moment\"","webpack:///external \"crossfilter2\"","webpack:///./lib/utils/local-query.js","webpack:///external \"keen-core\"","webpack:///./lib/index.js","webpack:///./lib/server.js"],"names":["handleRequest","config","args","parsedUrl","url","parse","options","host","path","method","headers","data","indexOf","api_key","params","JSON","stringify","Buffer","byteLength","req","https","request","res","statusCode","resolve","body","on","d","parsedBody","error","reject","error_code","Error","message","code","abort","write","end","GET","POST","PUT","DEL","httpHandlers","requestUrlAndOptions","undefined","send","bind","prototype","auth","str","obj","value","key","timeout","num","httpRequestType","httpHandler","httpOptions","self","analysis_type","split","pop","fetchAbortController","AbortController","httpHandlerResponse","requestPromise","Promise","signal","then","event_collection","response","query","emit","loadDataFromFile","file","extArr","ext","toLowerCase","responseBodyMethod","json","csv","filePath","join","__dirname","fs","readFile","encoding","err","fromString","sharedData","localQuery","debug","startedAt","Date","now","Array","isArray","result","rows","console","log","length","keysToPrint","forEach","combinedFilters","filters","supportedAnalysisTypes","find","item","order_by","property_name","filter","push","operator","target_property","group_by","timeframe","commonTime","parseTimeframe","returnPartial","start","moment","utc","timeframeParts","dateRelation","unitsNumber","units","unit","slice","startOf","subtract","onOutOfTimeframeRange","addTimeframeFilter","property_value","timestamp_parts","timestamp_from_value_this","timestamp_from_value_previous","subquery","timestamp_to_value_this","timestamp_to_value_previous","rootTimeframe","lastRow","lastRowTimeStamp","keen","timestamp","intervalFilters","interval","startTimestamp","endTimestamp","currentEndTimestamp","currentStartTimestamp","timestamp_to","intervalToUnits","secondly","minutely","hourly","daily","weekly","monthly","yearly","intervalStrParts","distance","promisesArray","diff","toISOString","add","extendResults","all","resultToValue","map","resItem","otherKeys","printQueryTime","getQueryMetadata","catch","dimensions","getNestedObject","nestedObj","pathArr","reduce","firstFilter","keys","dimension","found","itemInPropert","Object","group","limit","Infinity","directionMethod","top","bottom","getValueFromNestedKey","row","nestedKey","isNaN","resultRow","parseLocalResponse","reducer","accumulator","currentValue","half","Math","floor","index","percentile","i","fraction","direction","reverse","parser","sortAlpha","a","b","textA","toUpperCase","textB","rootQuery","queryBodyParams","timezone","getTimezoneOffset","resultParsed","sort","KeenLibrary","readKey","arguments","String","analysisType","queryParams","analysisTypeExtracted","cacheOptionsExtracted","cache","queryParamsExtracted","cacheOptions","get","masterKey","saved_query_name","savedQueryResultsUrl","name","dataset_name","post","Query","run","q","callback","cb","output","queries","promises","queryPromise","analysis","set","attributes","v","k","match","RegExp","replace","$1","dv","deepValue","deepKey","_deepKey","attribute","addFilter","property","KeenAnalysis","put","del","Keen","extendLibrary","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;ACnEA;;AAEA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;ACdA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,wCAAwC,SAAS;AACjD;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,+DAA+D;AAC/D;AACA;;AAEA;;;ACnOA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,CAAC;AACD;AACA;;;;;;;ACvBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,YAAY;AACzB;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC1BA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;;;;;ACdA,gC;;;;;;ACAA,kC;;;;;;;;;;;;;;ACAA;;;;AACA;;;;AAEA;;;;AACA;;;;;;AAEA,IAAMA,gBAAgB,SAAhBA,aAAgB,CAACC,MAAD,EAAuB;AAAA,MAAdC,IAAc,uEAAP,EAAO;;AAC3C,MAAMC,YAAYC,cAAIC,KAAJ,CAAUJ,OAAOG,GAAjB,CAAlB;;AAEA,MAAME,UAAU;AACdC,UAAMJ,UAAU,UAAV,CADQ;AAEdK,UAAML,UAAUK,IAFF;AAGdC,YAAQR,OAAO,QAAP,CAHM;AAIdS,aAAST,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","file":"node/keen-analysis.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"csvtojson\"), require(\"moment\"), require(\"crossfilter2\"), require(\"keen-core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"csvtojson\", \"moment\", \"crossfilter2\", \"keen-core\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"csvtojson\"), require(\"moment\"), require(\"crossfilter2\"), require(\"keen-core\")) : factory(root[\"csvtojson\"], root[\"moment\"], root[\"crossfilter2\"], root[\"keen-core\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(global, function(__WEBPACK_EXTERNAL_MODULE__11__, __WEBPACK_EXTERNAL_MODULE__13__, __WEBPACK_EXTERNAL_MODULE__14__, __WEBPACK_EXTERNAL_MODULE__16__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","module.exports = extend;\n\nfunction extend(target){\n  for (var i = 1; i < arguments.length; i++) {\n    for (var prop in arguments[i]){\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n","export default function(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n","import promiseFinally from './finally';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  this._state = 0;\n  this._handled = false;\n  this._value = undefined;\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!arr || typeof arr.length === 'undefined')\n      throw new TypeError('Promise.all accepts an array');\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(values) {\n  return new Promise(function(resolve, reject) {\n    for (var i = 0, len = values.length; i < len; i++) {\n      values[i].then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","import Promise from './index';\nimport promiseFinally from './finally';\n\nvar globalNS = (function() {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  throw new Error('unable to locate global object');\n})();\n\nif (!globalNS.Promise) {\n  globalNS.Promise = Promise;\n} else if (!globalNS.Promise.prototype['finally']) {\n  globalNS.Promise.prototype['finally'] = promiseFinally;\n}\n","module.exports = each;\n\nfunction each(o, cb, s){\n  var n;\n  if (!o){\n    return 0;\n  }\n  s = !s ? o : s;\n  if (o instanceof Array){\n    // Indexed arrays, needed for Safari\n    for (n=0; n<o.length; n++) {\n      if (cb.call(s, o[n], n, o) === false){\n        return 0;\n      }\n    }\n  } else {\n    // Hashtables\n    for (n in o){\n      if (o.hasOwnProperty(n)) {\n        if (cb.call(s, o[n], n, o) === false){\n          return 0;\n        }\n      }\n    }\n  }\n  return 1;\n}\n","var each = require('./each'),\n    extend = require('./extend');\n\nmodule.exports = serialize;\n\nfunction serialize(data){\n  var query = [];\n  each(data, function(value, key){\n    if ('string' !== typeof value) {\n      value = JSON.stringify(value);\n    }\n    query.push(key + '=' + encodeURIComponent(value));\n  });\n  return query.join('&');\n}\n","module.exports = require(\"url\");","module.exports = require(\"https\");","import https from 'https';\nimport url from 'url';\n\nimport extend from 'keen-core/lib/utils/extend';\nimport serialize from 'keen-core/lib/utils/serialize';\n\nconst handleRequest = (config, args = {}) => {\n  const parsedUrl = url.parse(config.url);\n\n  const options = {\n    host: parsedUrl['hostname'],\n    path: parsedUrl.path,\n    method: config['method'],\n    headers: config['headers']\n  };\n\n  let data = '';\n\n  if (config['method'] === 'GET' || config['method'] === 'DELETE') {\n    data = '';\n    if(options.path.indexOf('?') === -1){\n      options.path += '?';\n    } else {\n      options.path += '&';\n    }\n    options.path += 'api_key=' + config.api_key;\n    if (config.params) {\n      options.path += '&' + serialize(config.params);\n    }\n  }\n  else {\n    data = config.params ? JSON.stringify(config.params) : '';\n    options['headers']['Content-Length'] = Buffer.byteLength(data);\n  }\n\n  const req = https.request(options, function(res) {\n    if (options.method === 'DELETE' && res.statusCode === 204) {\n      return args.resolve({});\n    }\n    let body = '';\n    res.on('data', function(d) {\n      body += d;\n    });\n    res.on('end', function() {\n      let parsedBody;\n      try {\n        parsedBody = JSON.parse(body);\n      } catch (error) {\n        return args.reject(error);\n      }\n      if (parsedBody.error_code) {\n        let error = new Error(parsedBody.message || 'Unknown error occurred');\n        error.code = parsedBody.error_code;\n        return args.reject(error);\n      }\n      args.resolve(parsedBody);\n    });\n  });\n\n  req.on('error', args.reject);\n  req.on('abort', () => req.abort());\n  req.write(data);\n  req.end();\n\n  return req;\n}\n\nexport const GET = handleRequest;\nexport const POST = handleRequest;\nexport const PUT = handleRequest;\nexport const DEL = handleRequest;\n","// ignore polyfills for env Node or Browser\n","import each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\nimport 'abortcontroller-polyfill/dist/polyfill-patch-fetch';\nimport 'promise-polyfill/src/polyfill';\n\nexport default function request(method, httpHandlers){\n  this.httpHandlers = httpHandlers;\n  return function(requestUrlAndOptions, options = {}){\n    if (typeof requestUrlAndOptions === 'string') {\n      // backward compatibility\n      this.config = {\n        api_key : undefined,\n        method,\n        params  : {},\n        url: requestUrlAndOptions,\n        headers : {\n          'Authorization' : '',\n          'Content-type'  : 'application/json'\n        },\n        ...options\n      };\n      return this;\n    }\n\n    this.config = {\n      api_key : undefined,\n      params  : {},\n      method,\n      headers : {\n        'Authorization' : requestUrlAndOptions.api_key,\n        'Content-type'  : 'application/json'\n      },\n      ...requestUrlAndOptions,\n      ...options\n    };\n    return this.send();\n  }.bind(this);\n}\n\nrequest.prototype.auth = function(str){\n  if (typeof str === 'string') {\n    this.config.api_key = typeof str === 'string' ? str : undefined;\n    this.headers({\n      'Authorization': str\n    });\n  }\n  return this;\n};\n\nrequest.prototype.headers = function(obj){\n  if (typeof obj === 'object') {\n    each(obj, function(value, key){\n      this.config['headers'][key] = value;\n    }.bind(this));\n  }\n  return this;\n};\n\nrequest.prototype.timeout = function(num){\n  this.config.timeout = typeof num === 'number' ? num : 300 * 1000;\n  return this;\n};\n\nrequest.prototype.send = function(obj){\n  if (obj) {\n    this.config.params = (obj && typeof obj === 'object') ? obj : {};\n  }\n  let httpRequestType = this.config['method'];\n  if (httpRequestType === 'DELETE') {\n    // delete is a reserved word in JS, so to avoid bugs\n    httpRequestType = 'DEL';\n  }\n  const httpHandler = this.httpHandlers[httpRequestType];\n  const httpOptions = extend({}, this.config);\n  const self = this;\n\n  // Temporary mod to append analysis_type to responses\n  // for generic HTTP requests to known query resources\n  if (this.config['method'] !== 'DELETE'\n    && typeof httpOptions.params.analysis_type === 'undefined') {\n    if (httpOptions.url.indexOf('/queries/') > -1\n      && httpOptions.url.indexOf('/saved/') < 0) {\n        httpOptions.params.analysis_type =\n          httpOptions.url.split('/queries/').pop();\n    }\n  }\n\n  let fetchAbortController;\n  if (typeof AbortController !== 'undefined') {\n    fetchAbortController = new AbortController();\n  }\n\n  let httpHandlerResponse;\n  const requestPromise = new Promise((resolve, reject) => {\n    const options = {};\n    if (fetchAbortController) {\n      options.signal = fetchAbortController.signal;\n    }\n    options.resolve = resolve;\n    options.reject = reject;\n    httpHandlerResponse = httpHandler(httpOptions, options);\n    return httpHandlerResponse;\n  })\n  .then(response => {\n    if (httpOptions.params &&\n      typeof httpOptions.params.event_collection !== 'undefined'\n      && typeof response.query === 'undefined') {\n        return extend({ query: httpOptions.params }, response);\n    }\n    return response;\n  });\n\n  requestPromise.abort = () => {\n    if (fetchAbortController) {\n      // browser\n      return fetchAbortController.abort();\n    }\n\n    //node\n    httpHandlerResponse.emit('abort');\n  }\n\n  return requestPromise;\n};\n","module.exports = require(\"path\");","module.exports = require(\"fs\");","module.exports = __WEBPACK_EXTERNAL_MODULE__11__;","import csv from 'csvtojson';\nimport 'promise-polyfill/src/polyfill';\nimport fs from 'fs';\nimport path from 'path';\n\nexport const loadDataFromFile = (file) => {\n  const extArr = file.split('.');\n  const ext = extArr.pop().toLowerCase();\n  const responseBodyMethod = {json: 'json', csv: 'text'}[ext];\n\n  const filePath = path.join(__dirname, file);\n\n  return new Promise((resolve, reject) => {\n    fs.readFile(file, { encoding: 'utf-8' }, (err, res) => {\n      if (err) {\n        return reject(err);\n      }\n\n      if (ext === 'json') {\n        return resolve(res);\n      }\n\n      return csv()\n        .fromString(res)\n        .then((json) => {\n          resolve(json);\n        });\n    });\n  });\n}\n\nexport default loadDataFromFile;\n","module.exports = __WEBPACK_EXTERNAL_MODULE__13__;","module.exports = __WEBPACK_EXTERNAL_MODULE__14__;","import crossfilter from 'crossfilter2';\nimport moment from 'moment';\n\nimport loadDataFromFile from './browser-load-data-from-file';\n\nlet sharedData;\n\nexport const localQuery = (query) => {\n  if (query.debug && !query.startedAt) query.startedAt = Date.now();\n\n  if (!query.data && !query.file) {\n    throw 'Specify the source of the data: DATA or FILE';\n    return;\n  }\n\n  if (query.data && query.file) {\n    throw 'Use only one data source: DATA or FILE';\n    return;\n  }\n\n  if (query.file) {\n    return loadDataFromFile(query.file)\n      .then(res => {\n        return localQuery({\n          ...query,\n          file: undefined,\n          data: res\n        });\n      });\n  }\n\n  return new Promise((resolve, reject) => {\n    if (!sharedData) {\n      if (!query.data && query.res){\n        throw 'Use query.data instead of query.res property';\n        return;\n      }\n      if (Array.isArray(query.data)){\n        query.data = {\n          result: query.data\n        };\n      }\n      sharedData = query.data.result;\n      // don't copy this huge array - just make a reference to it\n      // so queries with Intervals don't overload the browser\n    }\n\n    const rows = crossfilter(sharedData);\n    query.data.result = null;\n\n    if (query.debug) {\n      console.log('! Welcome to the Local Query Experimental Feature !');\n      console.log('* Running a local query with:');\n      console.log('--', 'Number of events before filtering:', sharedData.length);\n      const keysToPrint = [\n        'analysis_type',\n        'filters',\n        'timeframe',\n        'interval',\n        'group_by',\n        'order_by',\n        'limit'\n      ];\n      keysToPrint.forEach(key => {\n        console.log('--', key, query[key]);\n      });\n    }\n\n    query.combinedFilters = [...(query.filters || [])] || [];\n    query.analysis_type = query.analysis_type || 'extraction';\n\n    const supportedAnalysisTypes = [\n      'extraction', 'count', 'count_unique', 'minimum', 'maximum', 'sum',\n      'average', 'median', 'percentile', 'select_unique'\n    ];\n    if (!supportedAnalysisTypes.find(item => item === query.analysis_type)) {\n      console.log(`${query.analysis_type} is not supported in the local queries`);\n      return;\n    }\n\n    // to group and be able to sort - we need to create a new dimension\n    if (query.order_by\n      && query.order_by.property_name !== 'result'\n      && !query.combinedFilters.find(filter => filter.property_name === query.order_by.property_name)) {\n      query.combinedFilters.push({\n        property_name: query.order_by.property_name,\n        operator: 'true'\n      });\n    }\n\n    if (query.target_property) {\n      query.group_by = query.target_property;\n    }\n\n    if (query.group_by) {\n      query.combinedFilters.push({\n        property_name: query.group_by,\n        operator: 'true'\n      });\n    }\n\n\n    // TIMEFRAME\n\n    if (!query.timeframe && query.data.query && query.data.query.timeframe) {\n      query.timeframe = query.data.query.timeframe;\n      // get timeframe from parent query (general results from cache/file)\n    }\n\n    const commonTime = Date.now(); // necessary to be able to compare dates\n\n    const parseTimeframe = ({ timeframe, returnPartial = false, commonTime }) => {\n      if (timeframe.start) {\n        // absolute\n        return {\n          start: moment.utc(timeframe.start),\n          end: moment.utc(timeframe.end)\n        };\n      }\n      const timeframeParts = timeframe.split('_');\n      const dateRelation = timeframeParts[0];\n      const unitsNumber = timeframeParts[1];\n      const units = timeframeParts[2];\n      const unit = units.slice(0, units.length -1);\n      if (!returnPartial) {\n        let start = moment().startOf(unit).subtract(unitsNumber - 1, units);\n        let end = moment().startOf(unit);\n        if (commonTime) {\n          start = moment.utc(commonTime).subtract(unitsNumber, units);\n          end = moment.utc(commonTime);\n        }\n        return {\n          start,\n          end\n        };\n      }\n      return {\n        dateRelation,\n        unitsNumber,\n        units\n      };\n    }\n\n    if (query.timeframe) {\n      if (\n        // check boundries only for data with metadata from a root query\n        query.data.query &&\n        (\n          (parseTimeframe({ timeframe: query.timeframe, commonTime }).start\n          <\n          parseTimeframe({ timeframe: query.data.query.timeframe, commonTime }).start)\n          ||\n          (\n            query.timeframe.end && (\n              parseTimeframe({ timeframe: query.data.query.timeframe, commonTime }).end\n              <\n              parseTimeframe({ timeframe: query.timeframe, commonTime }).end\n            )\n          )\n        )\n      ) {\n        if (query.debug) console.log(`Local query's timeframe is out of the Root Query timeframe range`);\n        if (query.onOutOfTimeframeRange) {\n          return query.onOutOfTimeframeRange();\n        }\n      }\n\n      const addTimeframeFilter = (timeframe) => {\n        if (timeframe.start) {\n          // ABSOLUTE timeframe\n          query.combinedFilters.push({\n            property_name: 'keen.timestamp',\n            operator: 'gte',\n            property_value: moment.utc(timeframe.start)\n          });\n          query.combinedFilters.push({\n            property_name: 'keen.timestamp',\n            operator: 'lt',\n            property_value: moment.utc(timeframe.end)\n          });\n        } else {\n          // RELATIVE timeframe\n          const timestamp_parts = parseTimeframe({ timeframe, returnPartial: true });\n          const unit = timestamp_parts.units.slice(0, timestamp_parts.units.length -1);\n\n          const timestamp_from_value_this = parseTimeframe({ timeframe }).start;\n          const timestamp_from_value_previous = parseTimeframe({ timeframe }).start\n            .startOf(unit);\n          if (!query.subquery) {\n            timestamp_from_value_previous.subtract(1, timestamp_parts.units);\n          }\n\n          const timestamp_to_value_this = moment();\n          const timestamp_to_value_previous = moment().startOf(unit);\n\n          if (timestamp_parts.dateRelation === 'previous'){\n            // previous\n            query.combinedFilters.push({\n              property_name: 'keen.timestamp',\n              operator: 'lt',\n              property_value: timestamp_to_value_previous\n            });\n            query.combinedFilters.push({\n              property_name: 'keen.timestamp',\n              operator: 'gte',\n              property_value: timestamp_from_value_previous\n            });\n          } else {\n            // this_\n            query.combinedFilters.push({\n              property_name: 'keen.timestamp',\n              operator: 'lt',\n              property_value: timestamp_to_value_this\n            });\n            query.combinedFilters.push({\n              property_name: 'keen.timestamp',\n              operator: 'gte',\n              property_value: timestamp_from_value_this\n            });\n          }\n        }\n      }\n\n      addTimeframeFilter(query.timeframe);\n\n      if (query.rootTimeframe) {\n        addTimeframeFilter(query.rootTimeframe);\n      }\n\n    }\n\n\n\n    // INTERVAL\n\n    const lastRow = sharedData && sharedData[sharedData.length - 1];\n    const lastRowTimeStamp = lastRow && lastRow.keen.timestamp;\n    const intervalFilters = [];\n    if (query.interval){\n      const startTimestamp = query\n        .combinedFilters.find(item => item.property_name === 'keen.timestamp'\n          && item.operator === 'gte').property_value;\n      let endTimestamp = (query\n        .combinedFilters.find(item => item.property_name === 'keen.timestamp'\n          && item.operator === 'lt') ||\n        {}\n      ).property_value || moment.utc(lastRowTimeStamp);\n\n      let currentEndTimestamp = moment.utc(startTimestamp);\n      let currentStartTimestamp;\n\n      const timestamp_to = parseTimeframe({ timeframe: query.timeframe, returnPartial: true, commonTime });\n\n      const intervalToUnits = {\n        secondly: 'seconds',\n        minutely: 'minutes',\n        hourly: 'hours',\n        daily: 'days',\n        weekly: 'weeks',\n        monthly: 'months',\n        yearly: 'years'\n      };\n\n      const intervalStrParts = query.interval.split('_');\n      const units = intervalStrParts[2] || intervalToUnits[query.interval];\n      const distance = intervalStrParts[1] || 1;\n\n      let promisesArray = [];\n      while(endTimestamp.diff(currentEndTimestamp, 'seconds') > 0) {\n        let timeframe = {\n          start: currentEndTimestamp.startOf(units).toISOString(),\n          end: currentEndTimestamp.add(distance, units).toISOString()\n        };\n        promisesArray.push(\n          localQuery({\n            ...query,\n            rootTimeframe: query.timeframe,\n            timeframe: { ...timeframe },\n            interval: null,\n            extendResults: {\n              timeframe: { ...timeframe }\n            },\n            subquery: true,\n            debug: false\n          })\n        );\n      }\n      if (query.debug) console.log(\n        `** Running ${promisesArray.length} subQueries because of Interval ${query.interval}`\n      );\n      return Promise\n        .all(promisesArray)\n        .then(res => {\n          const resultToValue = res.map(resItem => {\n            const { result, ...otherKeys } = resItem;\n            // Keen's API is responding with key called VALUE instead of RESULT,\n            // so we have to map that here\n            return { ...otherKeys, value: result };\n          });\n        printQueryTime(query);\n        return resolve({\n          result: resultToValue,\n          query: getQueryMetadata(query)\n        });\n      })\n      .catch(err => {\n        reject(err);\n      });\n    }\n\n    if (!query.combinedFilters.length) {\n      // we need to specify at least one filter to create a dimension\n      query.combinedFilters.push({\n        property_name: 'keen.timestamp',\n        operator: 'exists',\n        property_value: true\n      });\n    }\n\n    const dimensions = {};\n\n    // get nested Object property accessed by string like someObj.some_property\n    const getNestedObject = (nestedObj, pathArr) => {\n      return pathArr.reduce((obj, key) =>\n        (obj && obj[key] !== 'undefined') ? obj[key] : undefined, nestedObj);\n    }\n\n    let firstFilter;\n    query.combinedFilters.forEach(filter => {\n      if (!firstFilter) firstFilter = filter.property_name;\n      const keys = filter.property_name.split('.');\n      dimensions[filter.property_name] = dimensions[filter.property_name] || [];\n      dimensions[filter.property_name].push(\n        rows.dimension(function(d) {\n          return getNestedObject(d, keys);\n        })\n      );\n\n      // FILTERS\n\n      dimensions[filter.property_name][dimensions[filter.property_name].length - 1].filter(function(d) {\n        if (filter.operator === 'eq' && Array.isArray(d)) {\n          // mirror the strange API behaviour\n          filter.operator = 'eq_in';\n          if (query.debug) console.log(`Mirror API's behaviour - change EQ to EQ_IN`);\n        }\n        switch(filter.operator){\n          case 'eq':\n            return JSON.stringify(d) === JSON.stringify(filter.property_value);\n          break;\n          case 'eq_in':\n            if (!d) return false;\n            if (Array.isArray(d)){\n              return d.indexOf(filter.property_value) !== -1;\n            }\n            return JSON.stringify(d) === JSON.stringify(filter.property_value);\n          break;\n          case 'strict_eq':\n            // even if the D value is array\n            return JSON.stringify(d) === JSON.stringify(filter.property_value);\n          break;\n          case 'ne':\n            return JSON.stringify(d) !== JSON.stringify(filter.property_value);\n          break;\n          case 'gt':\n            if (filter.property_name === 'keen.timestamp') {\n              return moment(d).diff(filter.property_value, 'seconds') > 0;\n            }\n            return d > filter.property_value;\n          break;\n          case 'gte':\n            if (filter.property_name === 'keen.timestamp') {\n              return moment(d).diff(filter.property_value, 'seconds') >= 0;\n            }\n            return d >= filter.property_value;\n          break;\n          case 'lte':\n            if (filter.property_name === 'keen.timestamp') {\n              return moment(d).diff(filter.property_value, 'seconds') <= 0;\n            }\n            return d <= filter.property_value;\n          break;\n          case 'lt':\n            if (filter.property_name === 'keen.timestamp') {\n              return moment(d).diff(filter.property_value, 'seconds') < 0;\n            }\n            return d < filter.property_value;\n          break;\n          case 'exists':\n            return !!d === filter.property_value;\n          break;\n          case 'in':\n            if (!d) return false;\n            if (Array.isArray(filter.property_value) && Array.isArray(d)) {\n              let found = false;\n              filter.property_value.forEach(item => {\n                if (d.find(itemInPropert => itemInPropert === item)) {\n                  found = true;\n                }\n              });\n              return found;\n            }\n            if (Array.isArray(filter.property_value)) {\n              return filter.property_value.find(item => item === d);\n            }\n            if (Array.isArray(d)) {\n              return d.find(item => item === filter.property_value);\n            }\n          break;\n          case 'contains':\n            return d && d.indexOf(filter.property_value) !== -1;\n          break;\n          case 'not_contains':\n            return !d || d.indexOf(filter.property_value) === -1;\n          break;\n          case 'within':\n            reject('not supported operator: within');\n            return false; // TODO: geo coordinates\n          break;\n          default:\n            return true;\n        }\n      });\n    });\n\n    if (query.debug) console.log(`Dimensions created:`, Object.keys(dimensions));\n\n    let result = dimensions[firstFilter][0];\n\n    if (query.group_by) {\n      result = dimensions[query.group_by][0].group();\n    }\n\n    const limit = query.limit || Infinity;\n    let directionMethod = 'top';\n\n    if (query.debug) console.log(\n      `Order direction:`,\n      { top: 'asc', bottom: 'desc' }[directionMethod],\n      directionMethod\n    );\n\n    const getValueFromNestedKey = ({ row, nestedKey }) => {\n      if (!row) return undefined;\n      const keys = nestedKey.split('.');\n      const value = getNestedObject(row, keys);\n      if (isNaN(value)) {\n        return value;\n      }\n      return value*1;\n    }\n    // ANALYSIS TYPES\n\n    if (query.analysis_type === 'minimum') {\n      const resultRow = dimensions[query.group_by][0].bottom(1);\n      const value = getValueFromNestedKey({\n        row: resultRow[0],\n        nestedKey: query.target_property\n      });\n      const result = value;\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n    if (query.analysis_type === 'maximum') {\n      const resultRow = dimensions[query.group_by][0].top(1);\n      const value = getValueFromNestedKey({\n        row: resultRow[0],\n        nestedKey: query.target_property\n      });\n      const result = value;\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n    if (query.analysis_type === 'sum') {\n      const reducer = (accumulator = 0, currentValue) => {\n        return (getValueFromNestedKey({\n          row: accumulator,\n          nestedKey: query.target_property\n        }) || accumulator) + (getValueFromNestedKey({\n          row: currentValue,\n          nestedKey: query.target_property\n        }) || 0);\n      };\n      const resultRow = dimensions[query.group_by][0].top(Infinity);\n      let result = 0;\n      if (resultRow && resultRow.length) {\n        result = resultRow.reduce(reducer);\n      }\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n    if (query.analysis_type === 'average') {\n      const reducer = (accumulator = 0, currentValue) => {\n        return (getValueFromNestedKey({\n          row: accumulator,\n          nestedKey: query.target_property\n        }) || accumulator) + (getValueFromNestedKey({\n          row: currentValue,\n          nestedKey: query.target_property\n        }) || 0);\n      };\n      const resultRow = dimensions[query.group_by][0].top(Infinity);\n      let result = 0;\n      if (resultRow && resultRow.length) {\n        result = resultRow.reduce(reducer) / ((resultRow.length > 0 && resultRow.length) || 1);\n      }\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n    if (query.analysis_type === 'median') {\n      const resultRow = dimensions[query.target_property][0].top(Infinity);\n      let result = 0;\n      if (resultRow && resultRow.length) {\n        const half = Math.floor(resultRow.length / 2);\n        if (resultRow.length % 2) {\n          result = getValueFromNestedKey({\n            row: resultRow[half],\n            nestedKey: query.target_property\n          });\n        } else {\n          result = (getValueFromNestedKey({\n            row: resultRow[half - 1],\n            nestedKey: query.target_property\n            }) +\n            getValueFromNestedKey({\n            row: resultRow[half],\n            nestedKey: query.target_property\n            })) / 2.0;\n        }\n      }\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n    if (query.analysis_type === 'percentile') {\n      const resultRow = dimensions[query.target_property][0].bottom(Infinity);\n      let result = 0;\n      if (resultRow && resultRow.length) {\n        let index = query.percentile / 100 * (resultRow.length-1);\n        if (Math.floor(index) === index) {\n          result = getValueFromNestedKey({\n            row: resultRow[index],\n            nestedKey: query.target_property\n          });\n        } else {\n          const i = Math.floor(index);\n          const fraction = index - i;\n          result =\n            getValueFromNestedKey({\n              row: resultRow[i],\n              nestedKey: query.target_property\n            })\n            +\n            (\n              getValueFromNestedKey({\n                row: resultRow[i+1],\n                nestedKey: query.target_property\n              })\n              -\n              getValueFromNestedKey({\n                row: resultRow[i],\n                nestedKey: query.target_property\n              })\n             ) * fraction;\n        }\n      }\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n\n    // ORDER BY\n\n    if (query.order_by) {\n      let order_by = {\n        property_name: query.order_by.property_name || firstFilter,\n        direction: query.order_by.direction || 'ASC'\n      }\n      if (order_by.direction.toLowerCase() === 'asc') {\n        directionMethod = 'bottom';\n      }\n      if (query.group_by) {\n        order_by.property_name = 'result';\n      }\n      if (order_by.property_name === 'result'\n        || order_by.property_name === query.group_by) {\n        // group\n        if (directionMethod === 'bottom') {\n          // fix for the bug of the crossfilter lib\n          result = result.top(Infinity);\n          return resolve(\n            parseLocalResponse({\n              result: result.reverse().slice(0, limit),\n              parser: { group_by: query.group_by },\n              query\n            })\n          );\n        }\n        return resolve(\n          parseLocalResponse({\n            result: result[directionMethod](limit),\n            parser: { group_by: query.group_by },\n            query\n          })\n        );\n      }\n      result = dimensions[order_by.property_name][0][directionMethod](limit);\n      return resolve(\n        parseLocalResponse({\n          result,\n          query\n        })\n      );\n    }\n\n    return resolve(\n      parseLocalResponse({\n        result: result[directionMethod](limit),\n        query\n      })\n    );\n  });\n};\n\nconst sortAlpha = (a, b) => {\n  var textA = a.toUpperCase();\n  var textB = b.toUpperCase();\n  return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;\n};\n\nconst printQueryTime = (query) => {\n  if (query.debug) console.log('** Query time: ', Date.now() - query.startedAt, 'ms');\n}\n\nfunction getQueryMetadata(query){\n  const rootQuery = query && query.data && query.data.query;\n  let queryBodyParams  = {};\n  if (rootQuery) {\n    queryBodyParams  = { ...rootQuery };\n  } else {\n    queryBodyParams  =  {\n      analysis_type: query.analysis_type,\n      event_collection: query.event_collection,\n      timeframe: query.timeframe,\n      interval: query.interval,\n    };\n  }\n  queryBodyParams.timezone = new Date().getTimezoneOffset() * -60;\n  return queryBodyParams;\n}\n\nfunction parseLocalResponse({ result, parser = {}, query = {} }){\n  query.extendResults = query.extendResults || {};\n  if (!query.subquery) {\n    query.extendResults.query = getQueryMetadata(query);\n  }\n  if (!Array.isArray(result)) {\n    printQueryTime(query);\n    return {\n      result,\n      ...query.extendResults\n    };\n  }\n\n  let resultParsed = result;\n  if (parser.group_by) {\n    resultParsed = [];\n    let i = 0;\n    result.forEach(item => {\n      resultParsed[i++] = { [parser.group_by]: item.key, result: item.value };\n    });\n  }\n\n  if (query.analysis_type === 'count' && !query.group_by) {\n    resultParsed = resultParsed.length;\n  }\n\n  if (query.analysis_type === 'select_unique') {\n    resultParsed = resultParsed.map(value => value[Object.keys(value)[0]]);\n    if (typeof resultParsed[0] === 'string') {\n      resultParsed.sort(sortAlpha);\n    } else {\n      resultParsed.sort((a, b) => a - b);\n    }\n    if (query.order_by && query.order_by.direction === 'desc'){\n      resultParsed = resultParsed.reverse();\n    }\n  }\n\n  printQueryTime(query);\n\n  return {\n    result: resultParsed,\n    ...query.extendResults\n  };\n}\n\nexport default localQuery;\n","module.exports = __WEBPACK_EXTERNAL_MODULE__16__;","import 'promise-polyfill/src/polyfill';\nimport KeenLibrary from 'keen-core';\n\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\n\nimport localQuery from './utils/local-query';\n\nKeenLibrary.prototype.readKey = function(str){\n  if (!arguments.length) return this.config.readKey;\n  this.config.readKey = str ? String(str) : null;\n  return this;\n};\n\nKeenLibrary.prototype.query = function(a, b = undefined, options = {}){\n  // a - analysis type or config object\n  // b - params\n  let analysisType = a;\n  let queryParams = b;\n\n  // all this for backward compatibility, remove in next major version\n  if (typeof a === 'object' && !b) {\n    // initialized with signle argument - config object\n    const { analysis_type: analysisTypeExtracted,\n      cache: cacheOptionsExtracted,\n      ...queryParamsExtracted\n    } = a;\n    analysisType = analysisTypeExtracted;\n    queryParams = queryParamsExtracted;\n    let cacheOptions = this.config.cache;\n    if (cacheOptionsExtracted !== undefined) {\n      cacheOptions = cacheOptionsExtracted;\n    }\n    options.cache = cacheOptions;\n  }\n\n  // for deprecated queries\n  if (options.cache === undefined && this.config.cache) {\n    options.cache = { ...this.config.cache };\n  }\n\n  // read saved queries - DEPRECATED - to remove\n  if (analysisType && queryParams && typeof queryParams === 'string') {\n    if (queryParams.indexOf('/result') < 0) {\n      queryParams += '/result';\n    }\n    return this\n      .get({\n        url: this.url('queries', analysisType, queryParams),\n        api_key: this.config.readKey || this.config.masterKey\n      }, options);\n  }\n\n  // read saved queries\n  else if (queryParams && queryParams.saved_query_name) {\n    let savedQueryResultsUrl =\n      queryParams.saved_query_name.indexOf('/result') > -1 ?\n      queryParams.saved_query_name\n      :\n      `${queryParams.saved_query_name}/result`\n    ;\n    return this\n      .get({\n          url: this.url(\n            'queries',\n            'saved',\n            savedQueryResultsUrl\n          ),\n          api_key: this.config.readKey || this.config.masterKey\n        },\n        options);\n  }\n\n  // cached datasets - DEPRECATED\n  else if (analysisType === 'dataset' && typeof queryParams === 'object') {\n    return this\n      .get({\n        url: this.url('datasets', queryParams.name, 'results'),\n        api_key: this.config.readKey || this.config.masterKey,\n        params: queryParams\n      }, options);\n  }\n\n  else if (queryParams && queryParams.dataset_name) {\n    return this\n      .get({\n        url: this.url('datasets', queryParams.dataset_name, 'results'),\n        api_key: this.config.readKey || this.config.masterKey,\n        params: queryParams\n      }, options);\n  }\n\n  // standard queries\n  else if (analysisType && queryParams && typeof queryParams === 'object') {\n    // Include analysis_type for downstream use\n    const queryBodyParams = extend({ analysis_type: analysisType }, queryParams);\n\n    // Localize timezone if none is set\n    if (!queryBodyParams.timezone) {\n      queryBodyParams.timezone = new Date().getTimezoneOffset() * -60;\n    }\n\n    return this\n      .post({\n        url: this.url('queries', analysisType),\n        api_key: this.config.readKey || this.config.masterKey,\n        params: queryBodyParams\n      }, options);\n  }\n  else if (analysisType && typeof analysisType === 'string' && !queryParams) {\n    return Promise.reject({\n      error_code: 'SDKError',\n      message: \".query() called with incorrect arguments\"\n    });\n  }\n};\n\nKeenLibrary.prototype.localQuery = localQuery;\n\n// Keen.Query handler\n// --------------------------------\nKeenLibrary.Query = Query;\n\nKeenLibrary.prototype.run = function(q, callback){\n  const self = this;\n  const cb = callback;\n  let output;\n\n  const queries = q instanceof Array? q : [q];\n  const promises = [];\n\n  each(queries, function(query, i){\n    let queryPromise;\n    if (typeof query === 'string') {\n      queryPromise = self.query('saved', query + '/result');\n    }\n    else if (query instanceof KeenLibrary.Query) {\n      // Include analysis_type for downstream use\n      queryPromise = self.query(query.analysis, extend({ analysis_type: query.analysis }, query.params), query.options);\n    } else {\n      queryPromise = query;\n    }\n    // query.abort = queryPromise.abort;\n    promises.push(queryPromise);\n  });\n\n  if (promises.length > 1) {\n    output = Promise.all(promises);\n  }\n  else {\n    // Only return single\n    output = promises[0];\n  }\n\n  if (cb) {\n    // Manually handle callback, as\n    // Promise.nodeify drops nulls\n    output.then(function(res){\n      cb(null, res);\n    });\n    output['catch'](function(err){\n      cb(err, null);\n    });\n  }\n\n  return output;\n};\n\n// DEPRECATED\nfunction Query(analysisType, params = {}, options = {}) {\n  this.analysis = analysisType;\n  this.params = {};\n- this.set(params);\n  this.options = {...options};\n}\n\nQuery.prototype.set = function(attributes) {\n  // DEPRECATED\n  const self = this;\n  each(attributes, function(v, k){\n    let key = k;\n    let value = v;\n    if (k.match(new RegExp('[A-Z]'))) {\n      key = k.replace(/([A-Z])/g, function($1) { return '_'+$1.toLowerCase(); });\n    }\n    self.params[key] = value;\n    if (value instanceof Array) {\n      each(value, function(dv, index){\n        if (dv instanceof Array == false && typeof dv === 'object') {\n          each(dv, function(deepValue, deepKey){\n            if (deepKey.match(new RegExp('[A-Z]'))) {\n              var _deepKey = deepKey.replace(/([A-Z])/g, function($1) { return '_'+$1.toLowerCase(); });\n              delete self.params[key][index][deepKey];\n              self.params[key][index][_deepKey] = deepValue;\n            }\n          });\n        }\n      });\n    }\n  });\n  return self;\n};\n\nQuery.prototype.get = function(attribute) {\n  // DEPRECATED\n  let key = attribute;\n  if (key.match(new RegExp('[A-Z]'))) {\n    key = key.replace(/([A-Z])/g, function($1) { return '_'+$1.toLowerCase(); });\n  }\n  if (this.params) {\n    return this.params[key] || null;\n  }\n};\n\nQuery.prototype.addFilter = function(property, operator, value) {\n  // DEPRECATED\n  this.params.filters = this.params.filters || [];\n  this.params.filters.push({\n    'property_name': property,\n    'operator': operator,\n    'property_value': value\n  });\n  return this;\n};\n\nexport const KeenAnalysis = KeenLibrary;\nexport default KeenAnalysis;\n","import extend from 'keen-core/lib/utils/extend';\n\nimport KeenAnalysis from './index';\nimport request from './request';\nimport * as httpHandlers from './utils/http-server';\n\nKeenAnalysis.prototype.get = new request('GET', httpHandlers);\nKeenAnalysis.prototype.post = new request('POST', httpHandlers);\nKeenAnalysis.prototype.put = new request('PUT', httpHandlers);\nKeenAnalysis.prototype.del = new request('DELETE', httpHandlers);\n\nexport const Keen = KeenAnalysis.extendLibrary(KeenAnalysis);\nmodule.exports = Keen;\n"],"sourceRoot":""}